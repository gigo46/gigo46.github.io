<script>
    let editIndex = null;  // Menyimpan index barang yang sedang diedit

    // Fungsi untuk memuat data dari LocalStorage dan menampilkan di tabel
    function tampilkanBarang() {
        const dataBarang = JSON.parse(localStorage.getItem("barangKontrakan")) || [];

        const tabel = document.getElementById("tabelBarang").getElementsByTagName("tbody")[0];
        tabel.innerHTML = '';  // Bersihkan tabel

        dataBarang.forEach((item, index) => {
            let row = tabel.insertRow();
            row.innerHTML = `
                <td>${item.kategori}</td>
                <td>${item.barang}</td>
                <td>${item.jumlah}</td>
                <td>${item.pembawa}</td>
                <td>
                    <button onclick="editBarang(${index})">Edit</button>
                    <button class="btn-delete" onclick="hapusBarang(${index})">Hapus</button>
                </td>
            `;
        });
    }

    // Fungsi untuk menyimpan data barang ke LocalStorage
    function simpanBarang() {
        const kategori = document.getElementById("kategori").value;
        const barang = document.getElementById("barang").value;
        const jumlah = document.getElementById("jumlah").value;
        const pembawa = document.getElementById("pembawa").value;

        if (kategori && barang && jumlah) {
            let dataBarang = JSON.parse(localStorage.getItem("barangKontrakan")) || [];

            if (editIndex !== null) {
                // Jika sedang dalam mode edit, update data pada index tertentu
                dataBarang[editIndex] = { kategori, barang, jumlah, pembawa };
                editIndex = null; // Reset index setelah edit
            } else {
                // Jika baru, tambahkan data baru
                dataBarang.push({ kategori, barang, jumlah, pembawa });
            }

            localStorage.setItem("barangKontrakan", JSON.stringify(dataBarang));

            // Reset form input
            document.getElementById("formBarang").reset();

            // Tampilkan data setelah disimpan
            tampilkanBarang();
        } else {
            alert("Semua field harus diisi!");
        }
    }

    // Fungsi untuk mengedit barang
    function editBarang(index) {
        const dataBarang = JSON.parse(localStorage.getItem("barangKontrakan"));
        const item = dataBarang[index];

        // Set form dengan data yang ingin diedit
        document.getElementById("kategori").value = item.kategori;
        document.getElementById("barang").value = item.barang;
        document.getElementById("jumlah").value = item.jumlah;
        document.getElementById("pembawa").value = item.pembawa;

        // Set editIndex untuk menandakan bahwa kita sedang mengedit data ini
        editIndex = index;
    }

    // Fungsi untuk menghapus barang
    function hapusBarang(index) {
        const dataBarang = JSON.parse(localStorage.getItem("barangKontrakan"));
        dataBarang.splice(index, 1); // Hapus data pada index tertentu
        localStorage.setItem("barangKontrakan", JSON.stringify(dataBarang));
        tampilkanBarang(); // Tampilkan data setelah dihapus
    }

    // Menambahkan data awal ke LocalStorage
    function tambahDataAwal() {
        const dataBarangAwal = [
            { kategori: "Peralatan Memasak", barang: "Gas", jumlah: 1, pembawa: "Yogi" },
            { kategori: "Peralatan Memasak", barang: "Kompor", jumlah: 1, pembawa: "Maulana" },
            { kategori: "Peralatan Memasak", barang: "Selang gas", jumlah: 1, pembawa: "Yogi" },
            { kategori: "Peralatan Memasak", barang: "Langseng", jumlah: 1, pembawa: "" },
            { kategori: "Peralatan Memasak", barang: "Panci", jumlah: 1, pembawa: "Nopal" },
            { kategori: "Peralatan Memasak", barang: "Termos nasi", jumlah: 1, pembawa: "" },
            { kategori: "Peralatan Memasak", barang: "Hihid", jumlah: 1, pembawa: "Nopal" },
            { kategori: "Peralatan Makan (Per Orang)", barang: "Gelas", jumlah: 2, pembawa: "" },
            { kategori: "Peralatan Makan (Per Orang)", barang: "Piring/mangkuk", jumlah: 3, pembawa: "" },
            { kategori: "Peralatan Makan (Per Orang)", barang: "Sendok/garpu", jumlah: 3, pembawa: "" },
            { kategori: "Perlengkapan Tidur dan Ruangan (Per Orang)", barang: "Karpet", jumlah: 1, pembawa: "" },
            { kategori: "Perlengkapan Tidur dan Ruangan (Per Orang)", barang: "Kasur", jumlah: 1, pembawa: "" },
            { kategori: "Perlengkapan Tidur dan Ruangan (Per Orang)", barang: "Bantal", jumlah: 1, pembawa: "" },
            { kategori: "Peralatan Elektronik", barang: "Dispenser", jumlah: 1, pembawa: "Maulana" },
            { kategori: "Peralatan Elektronik", barang: "Setrika", jumlah: 1, pembawa: "" },
            { kategori: "Peralatan Elektronik", barang: "Mejikom", jumlah: 1, pembawa: "" },
            { kategori: "Peralatan Elektronik", barang: "Terminal listrik", jumlah: 2, pembawa: "Irvan, Irgi, Nopal, Maulana" },
            { kategori: "Peralatan Elektronik", barang: "Kipas angin", jumlah: 1, pembawa: "Nopal" },
            { kategori: "Perlengkapan Lain (Per Orang)", barang: "Beras", jumlah: 5, pembawa: "" },
            { kategori: "Perlengkapan Lain (Per Orang)", barang: "Galon air", jumlah: 2, pembawa: "Nopal" }
        ];

        // Simpan data awal ke LocalStorage
        localStorage.setItem("barangKontrakan", JSON.stringify(dataBarangAwal));

        // Tampilkan data setelah disimpan
        tampilkanBarang();
    }

    // Muat data saat halaman dimuat
    window.onload = function() {
        if (!localStorage.getItem("barangKontrakan")) {
            tambahDataAwal(); // Jika belum ada data di LocalStorage, tambah data awal
        } else {
            tampilkanBarang(); // Jika sudah ada data, tampilkan
        }
    };
</script>